<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Call the Cactus</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    html, body {
      height: 100%;
    }
    #map {
      height: 100%;
      width: 100%;
    }
    #button-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 10;
      transition: opacity 0.5s ease;
      opacity: 1;
    }
    .cta-button {
      background-color: orange;
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.2rem;
      cursor: pointer;
      border-radius: 5px;
      text-transform: uppercase;
      transition: background-color 0.3s ease;
      -webkit-appearance: none;
      margin-bottom: 20px;
    }
    .cta-button:active {
      background-color: darkorange;
    }
    .info-window {
      font-family: sans-serif;
    }
    .menu-buttons {
      margin-top: 10px;
    }
    .menu-buttons a {
      text-decoration: none;
      margin: 0 5px;
    }
    .status-bar {
      display: flex;
      gap: 4px;
      margin-bottom: 5px;
    }
    .bar {
      width: 20px;
      height: 5px;
      border-radius: 2px;
      background-color: lightgray;
    }
    .active-red {
      background-color: red;
    }
    .active-yellow {
      background-color: gold;
    }
    .active-green {
      background-color: mediumseagreen;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <div id="button-container">
    <a href="tel:+14356024304">
      <button class="cta-button">Call the Cactus</button>
    </a>
    <br />
    <a href="sms:+14356024304">
      <button class="cta-button">Text the Cactus</button>
    </a>
    <br />
    <a href="about.html">
      <button class="cta-button">Or... Learn More</button>
    </a>
  </div>

  <script>
    function initMap() {
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 10,
        center: { lat: 40.7, lng: -111.8 },
        disableDefaultUI: true
      });

      const locations = [
        { lat: 40.63187478288313, lng: -111.488077538129840, title: "Hopkins", status: 3 },
        { lat: 40.79079537119528, lng: -111.8870219260070734, title: "Cosby", status: 1 },
        { lat: 40.66657863620859, lng: -111.4940910476343136, title: "Tanner", status: 3 },
        { lat: 40.65040926474864, lng: -111.3141574976087539, title: "Hennessy", status: 2 },
        { lat: 40.70017011307595, lng: -111.5490344880542347, title: "Barrick", status: 1 },
        { lat: 40.7672909767582, lng: -111.5279312398168232, title: "Goldsmith", status: 2 }
      ];

      const bounds = new google.maps.LatLngBounds();
      let infoWindows = [];
      let showTitles = false;

      const menu = document.getElementById("button-container");
      let timeout;

      function hideMenu() {
        menu.style.opacity = 0;
      }

      function showMenu() {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          menu.style.opacity = 1;
        }, 1000);
      }

      map.addListener("dragstart", hideMenu);
      map.addListener("zoom_changed", hideMenu);
      map.addListener("idle", showMenu);

      // Toggle all titles on map click
      map.addListener("click", () => {
        infoWindows.forEach(iw => iw.close());
        if (!showTitles) {
          locations.forEach((loc, index) => {
            const iw = new google.maps.InfoWindow({
              content: `<div class="info-window"><strong>${loc.title}</strong></div>`
            });
            iw.open(map, markers[index]);
            infoWindows[index] = iw;
          });
        } else {
          infoWindows.forEach(iw => iw.close());
        }
        showTitles = !showTitles;
      });

      const markers = locations.map((loc, i) => {
        const marker = new google.maps.Marker({
          position: { lat: loc.lat, lng: loc.lng },
          map,
          title: loc.title
        });
        bounds.extend(marker.getPosition());

        let statusHTML = '<div class="status-bar">';
        for (let j = 1; j <= 3; j++) {
          let className = 'bar';
          if (loc.status === 1 && j === 1) className += ' active-red';
          if (loc.status === 2 && j <= 2) className += ' active-yellow';
          if (loc.status === 3) className += ' active-green';
          statusHTML += `<div class="${className}"></div>`;
        }
        statusHTML += '</div>';

        const infoWindow = new google.maps.InfoWindow({
          content: `<div class="info-window">
                      ${statusHTML}
                      <strong>${loc.title}</strong>
                      <div class="menu-buttons">
                        <a href="#">Project Info</a> |
                        <a href="#">Cameras</a> |
                        <a href="tel:+14356024304">Call</a> |
                        <a href="sms:+14356024304">Text</a>
                      </div>
                    </div>`
        });

        marker.addListener("click", () => {
          infoWindows.forEach(iw => iw.close());
          infoWindow.open(map, marker);
          infoWindows[i] = infoWindow;
        });

        return marker;
      });

      map.fitBounds(bounds);
    }
  </script>

  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCy0CmR2bZF9YBNfSGX5hZ-wK1MD1AwOu0&callback=initMap">
  </script>
</body>
</html>
